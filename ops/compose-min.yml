services:
  mosquitto:
    image: eclipse-mosquitto:2
    container_name: sigloom-mosquitto
    restart: unless-stopped
    ports: ['1883:1883']
    volumes:
      - ./mosquitto.conf:/mosquitto/config/mosquitto.conf:ro

  backend:
    build: ../backend
    container_name: sigloom-backend
    ports: ['8080:8080']
    environment:
      - API_HOST=0.0.0.0
      - API_PORT=8080
      - API_CORS_ALLOW_ALL=true
      - API_MQTT_URL=mqtt://mosquitto:1883
      - API_SHADOW_OFFLINE_AFTER_SEC=60
      - API_SHADOW_SWEEP_INTERVAL_SEC=5
    restart: unless-stopped
    depends_on: [ mosquitto ]

  frontend:
    build: ../frontend
    container_name: sigloom-frontend
    ports: ['3000:3000']
    environment:
      - NEXT_PUBLIC_API_BASE=http://backend:8080
    restart: unless-stopped
    depends_on: [ backend ]

networks:
  default:
    name: sigloom-net
